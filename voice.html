<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>ROZ Voice Bot</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  body{font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:#fff;color:#111}
  header{padding:16px;border-bottom:1px solid #eee;position:sticky;top:0;background:#fff}
  main{max-width:820px;margin:0 auto;padding:16px}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  button,select,input{padding:10px 14px;border:1px solid #ddd;border-radius:12px;background:#fff}
  button{cursor:pointer}
  #talk{background:#0ea5e9;color:#fff;border-color:#0ea5e9}
  #stop{background:#f3f4f6}
  #log{margin-top:14px;background:#f5f7fb;border-radius:14px;padding:12px;min-height:130px;white-space:pre-wrap}
  iframe{width:100%;height:260px;border:0;border-radius:12px;margin-top:10px}
  .hint{font-size:12px;color:#666}
</style>
</head>
<body>
<header>
  <div class="row">
    <strong>üéôÔ∏è ROZ Voice Bot</strong>
    <a href="./" style="margin-left:auto">‚Üê Back to Dashboard</a>
  </div>
</header>

<main>
  <div class="row">
    <label>Language:</label>
    <select id="lang">
      <option value="en-IN">English (India)</option>
      <option value="te-IN">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å (India)</option>
    </select>
    <button id="talk">Hold to Talk</button>
    <button id="stop">Stop Speaking</button>
  </div>

  <div class="row" style="margin-top:8px">
    <input id="text" style="flex:1" placeholder="Ask: how are you ‚Ä¢ weather in Hyderabad ‚Ä¢ play Telugu songs">
    <button id="send">Ask</button>
  </div>
  <div class="hint">Tip: Use Chrome on mobile/desktop. Mic requires HTTPS (GitHub Pages is OK).</div>

  <div id="log"></div>
  <div id="player"></div>
</main>

<script>
const logBox = document.getElementById('log');
const playerDiv = document.getElementById('player');
const langSel = document.getElementById('lang');
const textIn  = document.getElementById('text');
const btnSend = document.getElementById('send');
const btnTalk = document.getElementById('talk');
const btnStop = document.getElementById('stop');

function log(m){ logBox.textContent += m + "\n"; logBox.scrollTop = logBox.scrollHeight; }
function speak(txt){
  if(!window.speechSynthesis) return alert("Speech Synthesis not supported in this browser.");
  const u = new SpeechSynthesisUtterance(txt);
  u.lang = langSel.value;
  window.speechSynthesis.cancel();
  window.speechSynthesis.speak(u);
}
btnStop.onclick = ()=>window.speechSynthesis.cancel();

function norm(q){ return q.toLowerCase().replace(/\s+/g,' ').trim(); }
function smallTalk(q){
  const n = norm(q);
  if(n.includes("how are you") || n.includes("how r u") || n.includes("ela unnaru") || n.includes("meeru ela")) return "I‚Äôm good! How can I help you?";
  if(n==="hi"||n==="hello"||n.includes("namaste")||n.includes("namask")) return "Hello! Ask me for weather or say: play Telugu songs.";
  if(n.includes("your name") || q.includes("‡∞Æ‡±Ä ‡∞™‡±á‡∞∞‡±Å") || n.includes("mee peru")) return "I‚Äôm your ROZ voice bot.";
  return null;
}
function parseCity(q){
  const words = q.replace(/[?.,]/g,' ').split(/\s+/);
  const i = words.indexOf("in"); if(i>=0 && i+1<words.length) return words[i+1];
  const j = words.indexOf("lo"); if(j>=0 && j+1<words.length) return words[j+1];
  return null;
}
function wantsWeather(q){ const n=norm(q); return n.includes("weather") || q.includes("‡∞µ‡∞æ‡∞§‡∞æ‡∞µ‡∞∞‡∞£"); }
function wantsPlay(q){ const n=norm(q); return (n.includes("play") && n.includes("song")) || n.includes("telugu song") || q.includes("‡∞™‡∞æ‡∞ü"); }

async function weather(city){
  try{
    if(!city) city = "Hyderabad";
    const g = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(city)}&count=1&language=en&format=json`);
    const gj = await g.json();
    if(!gj.results || !gj.results.length) return `Sorry, I couldn‚Äôt find ${city}.`;
    const { latitude, longitude, name, country } = gj.results[0];
    const w = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current=temperature_2m,apparent_temperature,weather_code`);
    const wj = await w.json();
    const t  = Math.round(wj.current.temperature_2m);
    const tf = Math.round(wj.current.apparent_temperature);
    const code = wj.current.weather_code;
    const desc = ({
      0:"clear sky",1:"mainly clear",2:"partly cloudy",3:"overcast",
      45:"foggy",48:"rime fog",51:"light drizzle",53:"drizzle",55:"dense drizzle",
      61:"light rain",63:"rain",65:"heavy rain",71:"light snow",73:"snow",75:"heavy snow",
      80:"rain showers",81:"heavy showers",82:"violent showers",95:"thunderstorm",
      96:"thunder w/ hail",99:"severe thunderstorm"
    })[code] || "moderate";
    return langSel.value.startsWith("te")
      ? `${name} ‡∞≤‡±ã ‡∞µ‡∞æ‡∞§‡∞æ‡∞µ‡∞∞‡∞£‡∞Ç: ${desc}. ‡∞â‡∞∑‡±ç‡∞£‡±ã‡∞ó‡±ç‡∞∞‡∞§ ${t}¬∞C, ‡∞Ö‡∞®‡∞ø‡∞™‡∞ø‡∞Ç‡∞ö‡±á ‡∞â‡∞∑‡±ç‡∞£‡±ã‡∞ó‡±ç‡∞∞‡∞§ ${tf}¬∞C.`
      : `Weather in ${name}, ${country}: ${desc}. Temperature ${t}¬∞C, feels like ${tf}¬∞C.`;
  }catch(e){ return "Weather service not reachable right now."; }
}
function youtubeEmbedFor(q){
  const s = encodeURIComponent(q || "Telugu songs");
  return `https://www.youtube-nocookie.com/embed?autoplay=1&mute=0&listType=search&list=${s}`;
}

async function handle(q){
  if(!q) return; log("üßë You: "+q);

  const st = smallTalk(q);
  if(st){ log("ü§ñ Bot: "+st); speak(st); playerDiv.innerHTML=""; return; }

  if(wantsWeather(q)){
    const say = await weather(parseCity(q));
    log("ü§ñ Bot: "+say); speak(say); playerDiv.innerHTML=""; return;
  }

  if(wantsPlay(q)){
    let n = q; const i = n.toLowerCase().indexOf("play");
    if(i>=0) n = n.substring(i+4).trim();
    if(!n) n = "Telugu songs";
    const say = `Playing ${n} on YouTube.`; log("ü§ñ Bot: "+say); speak(say);
    playerDiv.innerHTML = `<iframe allow="autoplay; encrypted-media" src="${youtubeEmbedFor(n)}"></iframe>`;
    return;
  }

  const fb = langSel.value.startsWith("te")
    ? "‡∞Ö‡∞¶‡∞ø ‡∞Ö‡∞∞‡±ç‡∞•‡∞Ç ‡∞ï‡∞æ‡∞≤‡±á‡∞¶‡±Å. ‡∞Æ‡±Ä‡∞∞‡±Å ‡∞µ‡∞æ‡∞§‡∞æ‡∞µ‡∞∞‡∞£‡∞Ç ‡∞Ö‡∞°‡∞ó‡∞Ç‡∞°‡∞ø ‡∞≤‡±á‡∞ï ‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å ‡∞™‡∞æ‡∞ü‡∞≤‡±Å ‡∞™‡±ç‡∞≤‡±á ‡∞ö‡±á‡∞Ø‡∞Æ‡∞®‡∞ø ‡∞ö‡±Ü‡∞™‡±ç‡∞™‡∞Ç‡∞°‡∞ø."
    : "I didn‚Äôt get that. Ask for weather or say: play Telugu songs.";
  log("ü§ñ Bot: "+fb); speak(fb); playerDiv.innerHTML="";
}

// UI
btnSend.onclick = ()=>handle(textIn.value.trim());
let rec, listening=false;
if('webkitSpeechRecognition' in window){
  rec = new webkitSpeechRecognition(); rec.continuous=false; rec.interimResults=false;
  rec.onresult = e => { const t = e.results[0][0].transcript; handle(t); };
  rec.onend = ()=> listening=false;
} else {
  btnTalk.disabled = true; log("‚ö†Ô∏è Your browser doesn‚Äôt support speech recognition. Type your query.");
}
function startRec(){ if(!rec) return; try{ rec.lang = langSel.value; listening=true; rec.start(); log("üé§ (listening)"); }catch(e){} }
function stopRec(){ if(rec && listening){ rec.stop(); listening=false; } }
btnTalk.onmousedown = startRec; btnTalk.ontouchstart = startRec;
btnTalk.onmouseup   = stopRec;  btnTalk.ontouchend   = stopRec; btnTalk.onmouseleave = stopRec;
</script>
</body>
</html>
